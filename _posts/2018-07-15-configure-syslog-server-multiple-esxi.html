---
layout: post
title: PowerCLI - Configure syslog server in multiple ESXi
date: 2018-07-15 13:20:17.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- PowerCLI
tags:
- coding
- esxi
- powercli
- powershell
- vCenter
- VMware
meta:
  np_single_post_sidebar: default_sidebar
  post_meta_identity: np-metabox-info
  _thumbnail_id: '184'
  _dp_original: '458'
  _edit_last: '5'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1535982874;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:458;}i:1;a:1:{s:2:"id";i:194;}i:2;a:1:{s:2:"id";i:164;}}}}
  _wp_old_slug: set-esxi-remote-syslog-multiple-hosts-vcenter-within-vmware-cluster
  _wpghs_github_path: _posts/2018-07-15-configure-syslog-server-multiple-esxi.md
  _sha: cabd84872c83cbcf9e8be41e6d12a7c961c3cd6f
author:
  login: ricardo.adao
  email: ricardo.adao@gmail.com
  display_name: Ricardo Adao
  first_name: Ricardo
  last_name: Adao
---
<p>This is a quick powershell script to setup the <em>remote syslog</em> in all the hosts of a cluster or vCenter.</p>
<h4>The script has 4 mandatory parameters and 1 optional parameter:</h4>
<ul>
<li>Mandatory:
<ul>
<li><strong><em>vCenter</em> </strong>- vCenter FQDN/IP to connect too</li>
<li><strong><em>vCenterUsername</em> </strong>- vCenter Username to be used</li>
<li><strong><em>vCenterPassword</em> </strong>- corresponding password</li>
<li><strong><em>remoteSyslog</em> </strong>- FQDN/IP of the syslog server to use<em><br />
</em></li>
</ul>
</li>
<li>Optional:
<ul>
<li><strong><em>cluster</em></strong> - Cluster name if we want to change the hosts from a single cluster</li>
<li><strong><em>syslogPort</em></strong> - In case of using an alternative port, will use <em>514</em> as default</li>
</ul>
</li>
</ul>
<h4>Similar to earlier posts the code is pretty simple, so we will focus in the relevant bits:</h4>
<ul>
<li>List the current status
<pre lang="powershell"># Show current config
$vmHosts | ForEach-Object {
    Write-Host $_.Name
    Get-VMHostSysLogServer -VMHost $_
}</pre>
</li>
<li>Set the remoteSyslog server in each ESXi
<pre lang="powershell"># Set syslog config in hypervisors
$vmHosts | ForEach-Object {
    Write-Host $_.Name
    Set-VMHostSysLogServer -SysLogServer $remoteSyslog":"$syslogPort -VMHost $_
}</pre>
</li>
<li>Restart syslog and set the allow rules using Get-Esxcli
<pre lang="powershell"># Restart syslog and set the allow rules in the ESXi
$vmHosts | ForEach-Object {
    Write-Host $_.Name
    (Get-Esxcli -v2 -VMHost $_).system.syslog.reload.Invoke()
    (Get-Esxcli -v2 -VMHost $_).network.firewall.ruleset.set.Invoke(@{rulesetid='syslog'; enabled=$true})
    (Get-Esxcli -v2 -VMHost $_).network.firewall.refresh.Invoke()
}</pre>
</li>
</ul>
<ul>
<li>
<h3><em>Github</em> Link for the entire script: <a id="3d163e1fcac63cc037cc983ff10e168a-60e6d2bfcfa450134efd0cce791b92c4804eebf7" class="js-navigation-open" title="set.esxi.power.settings.ps1" href="https://github.com/ricardonadao/vrandombites.co.uk/blob/master/ESXi/set.esxi.syslog.ps1">set.esxi.syslog.ps1</a></h3>
</li>
</ul>
<p>&nbsp;</p>
