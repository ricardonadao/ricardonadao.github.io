---
layout: post
title: PowerCLI - Using Get-EsxCli to get settings or change settings in multiple
  ESXi hosts at a time
date: 2018-05-15 08:11:14.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- PowerCLI
tags:
- coding
- esxi
- hypervisor
- oneliner
- powercli
- powershell
- VMware
author:
  login: ricardo.adao
  email: ricardo.adao@gmail.com
  display_name: Ricardo Adao
  first_name: Ricardo
  last_name: Adao
---
<p>Following the earlier post (<a href="https://vrandombites.co.uk/2018/05/coding/vmware-powercli/vmware-powercli-check-mtu-size-configured-all-hosts-physical-nics-cluster/">Checking MTU size</a>) lets see what more can we do with <em>Get-EsxCli</em> cmdlet.</p>
<p><em>Get-EsxCli</em> is a way of using the <em>esxcli</em> command present in any ESXi shell, but from a Powershell shell.</p>
<p><em>       Reference: <a href="https://code.vmware.com/docs/6702/cmdlet-reference#/doc/Get-EsxCli.html">PowerCLI Get-EsxCli</a></em></p>
<p>Having that in mind lets use examples to show how we can leverage it to get, or set, some host configuration in multiple hosts connected to a vCenter using Powershell scripting.</p>
<p>Lets check what is available to us:</p>
<p><a href="https://vrandombites.co.uk/wp-content/uploads/2018/05/getesxcli-list-commands-available.png"><img class="size-full wp-image-196 aligncenter" src="{{ site.baseurl }}/assets/getesxcli-list-commands-available.png" alt="" width="958" height="566" /></a></p>
<p>Lets now compare what is available in <em>esxcli</em> via command line:</p>
<p><a href="https://vrandombites.co.uk/wp-content/uploads/2018/05/esxcli-list-commands-available.png"><img class="aligncenter size-full wp-image-197" src="{{ site.baseurl }}/assets/esxcli-list-commands-available.png" alt="" width="978" height="442" /></a></p>
<p>They are the same meaning that we will be able to use the <em>Get-EsxCli</em> to get any information that we would be able to get via the <em>esxcli</em> in the ESXi shell.</p>
<p>Lets compare side by side the differences of using the two:</p>
<p><a href="https://vrandombites.co.uk/wp-content/uploads/2018/05/esxcli.getesxcli.sidebyside.png"><img class="aligncenter size-full wp-image-199" src="{{ site.baseurl }}/assets/esxcli.getesxcli.sidebyside.png" alt="" width="820" height="239" /><br />
</a></p>
<p><em>            <strong>Note</strong>: as stated in the <a href="https://code.vmware.com/docs/6702/cmdlet-reference#/doc/Get-EsxCli.html">Get-EsxCli</a> reference the use of -v2 is advised, since it is the only way of guarantee compatibility across different ESXi versions</em></p>
<p>Being the info the same we should be able to use <em>Get-EsxCli</em> cmdlet to get/set the same information in multiple hosts.</p>
<p>There is a difference in the "command syntax" as you can see in the pictures above, but it is pretty straight forward to understand that the "<em>command path</em>" is pretty much the same.</p>
<p>&nbsp;</p>
<p>So now how can we use the <em>Get-EsxCli</em> cmdlet to configure something the same way we would do it with <em>esxcli</em>.</p>
<p>Lets use the example above and change the "<em>Remote Host</em>" value:</p>
<p><a href="https://vrandombites.co.uk/wp-content/uploads/2018/05/set.esxcli.getesxcli.sidebyside.png"><img class="aligncenter size-large wp-image-201" src="{{ site.baseurl }}/assets/set.esxcli.getesxcli.sidebyside-1024x615.png" alt="" width="640" height="384" /></a></p>
<p>It becomes a bit more complicated however, it would be easier to create a simple oneliner Powershell script to get this change applied to an entire VMware cluster:</p>
<p><a href="https://vrandombites.co.uk/wp-content/uploads/2018/05/set.esxcli.syslog.cluster.change.png"><img class="aligncenter wp-image-202 size-large" src="{{ site.baseurl }}/assets/set.esxcli.syslog.cluster.change-1024x856.png" alt="" width="640" height="535" /></a></p>
<p>Summary of the commands used above:</p>
<pre lang="powershell">Get-Cluster -Name "{cluster name}" | Get-VMHost | `
   %{ Write-Host $_.Name ; `
   (Get-Esxcli -v2 -VMHost $_).system.syslog.config.get.Invoke()}

Get-Cluster -Name "{cluster name}" | Get-VMHost | `
   %{ Write-Host $_.Name ; `
   (Get-Esxcli -v2 -VMHost $_).system.syslog.config.set.Invoke(@{loghost="{syslog IP/FQDN}"})}
</pre>
